---
name: run_refactor_agent
description: 代码重构专家助手。使用此技能当用户需要分析代码结构、重构代码、优化文件组织时。
---

# Code Refactor Agent Skill

## Quick Start

当用户需要以下帮助时使用此技能：
- "分析代码结构"
- "重构这个文件"
- "优化目录组织"
- "提取组件"
- "移动文件"

## Capabilities

- **代码结构分析**：扫描代码库，生成目录结构可视化报告
- **大文件检测**：识别超大文件（>300行），建议拆分方案
- **依赖关系映射**：分析 import/require 依赖关系图
- **代码模式识别**：检测重复代码、反模式、未使用导入
- **重构计划生成**：创建文件移动、组件提取、导入更新计划
- **重构执行**：执行重构任务（自动备份原始文件）

## Parameters

- `task` (required): 重构任务描述
- `autoApply` (optional): 是否自动执行重构（默认 false，先生成计划）
- `backup` (optional): 是否备份原始文件（默认 true）

## Examples

```
用户: 分析代码库结构
→ task: "分析代码库结构，生成报告"

用户: 重构这个文件
→ task: "重构 src/index.ts，拆分大函数"

用户: 优化项目目录
→ task: "重组 src 目录结构，按功能模块分类"

用户: 提取公共组件
→ task: "从 components/LargeComponent.tsx 提取可复用组件"
```

## Output Format

提供：
1. **分析模式**：结构化报告（大文件、依赖关系、模式识别）
2. **计划模式**：详细重构计划（文件移动、导入更新、风险评估）
3. **执行模式**：重构结果摘要（变更文件列表、备份位置）

## Features

### 代码结构分析
```
- 目录树可视化
- 文件统计（数量、行数、大小）
- 模块组织评估
```

### 大文件检测
```
- 识别超过 300 行的文件
- 拆分建议
- 复杂度评估
```

### 依赖关系映射
```
- Import/require 依赖图
- 循环依赖检测
- 未使用依赖识别
```

### 重构计划
```
- 文件移动计划（with 理由）
- 导入路径更新清单
- 组件提取方案
- 风险评估
```

## Safety Features

- **自动备份**：重构前自动创建 `.refactor-backup` 目录
- **计划预览**：默认先生成计划，不自动执行
- **风险提示**：标注潜在风险和影响范围
- **回滚支持**：保留备份便于恢复

## Best Practices

1. 先用"分析"模式了解代码库
2. 审查生成的重构计划
3. 确认后再执行重构
4. 测试重构后的代码
5. 必要时从备份恢复

## Notes

- 支持 TypeScript 和 JavaScript 文件
- 自动忽略 `node_modules` 和 `.` 开头的目录
- 大文件阈值可配置（默认 300 行）
