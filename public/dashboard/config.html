<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>系统配置 - QQ-Claude-Proxy Dashboard</title>
  <link rel="stylesheet" href="styles.css?v=3.4">
  <link rel="stylesheet" href="config.css?v=1.0">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>🤖</text></svg>">
</head>
<body>
  <div class="app-container">
    <!-- Header -->
    <header class="header">
      <div class="header-left">
        <a href="index.html" class="back-link">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M19 12H5M12 19l-7-7 7-7"/>
          </svg>
          <span>返回 Dashboard</span>
        </a>
        <div class="logo">
          <svg class="logo-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="3"/>
            <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/>
          </svg>
          <h1>系统配置</h1>
        </div>
      </div>
      <div class="header-right">
        <div class="status-indicator" id="connectionStatus">
          <span class="status-dot"></span>
          <span class="status-text">连接中...</span>
        </div>
        <button class="btn-primary" id="saveBtn">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/>
            <polyline points="17 21 17 13 7 13 7 21"/>
            <polyline points="7 3 7 8 15 8"/>
          </svg>
          保存配置
        </button>
      </div>
    </header>

    <!-- Main Content -->
    <main class="main-content">
      <!-- Restart Notice -->
      <div class="restart-notice" id="restartNotice" style="display: none;">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"/>
          <line x1="12" y1="8" x2="12" y2="12"/>
          <line x1="12" y1="16" x2="12.01" y2="16"/>
        </svg>
        <div class="notice-content">
          <div class="notice-title">配置已更改</div>
          <div class="notice-text">部分配置需要重启服务才能生效</div>
        </div>
        <button class="btn-secondary btn-sm" id="restartNowBtn">立即重启</button>
      </div>

      <div class="config-grid">
        <!-- Connection Settings -->
        <section class="config-section">
          <div class="section-header">
            <h2>
              <svg class="section-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"/>
                <line x1="2" y1="12" x2="22" y2="12"/>
                <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/>
              </svg>
              连接设置
            </h2>
          </div>
          <div class="form-group">
            <label for="gatewayHost">Gateway 主机</label>
            <input type="text" id="gatewayHost" class="form-input" placeholder="127.0.0.1">
          </div>
          <div class="form-group">
            <label for="gatewayPort">Gateway 端口</label>
            <input type="number" id="gatewayPort" class="form-input" min="1024" max="65535">
          </div>
          <div class="form-group checkbox-block">
            <input type="checkbox" id="qqbotEnabled" class="form-checkbox">
            <span>启用 QQ Bot</span>
          </div>
          <div class="form-group checkbox-block">
            <input type="checkbox" id="sandboxMode" class="form-checkbox">
            <span>沙箱模式 (测试环境)</span>
          </div>
        </section>

        <!-- QQ Bot API Keys -->
        <section class="config-section">
          <div class="section-header">
            <h2>
              <svg class="section-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
                <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
              </svg>
              QQ Bot API 密钥
            </h2>
          </div>
          <div class="form-group">
            <label for="qqbotAppId">App ID</label>
            <input type="text" id="qqbotAppId" class="form-input" placeholder="从 QQ 开放平台获取">
          </div>
          <div class="form-group">
            <label for="qqbotClientSecret">Client Secret</label>
            <div class="secret-input-group">
              <input type="password" id="qqbotClientSecret" class="form-input" placeholder="从 QQ 开放平台获取">
              <button type="button" class="btn-toggle-secret" data-target="qqbotClientSecret" title="显示/隐藏">
                <svg class="eye-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                  <circle cx="12" cy="12" r="3"/>
                </svg>
                <svg class="eye-off-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display: none;">
                  <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"/>
                  <line x1="1" y1="1" x2="23" y2="23"/>
                </svg>
              </button>
            </div>
          </div>
          <div class="form-group">
            <label for="qqbotToken">Bot Token (可选)</label>
            <div class="secret-input-group">
              <input type="password" id="qqbotToken" class="form-input" placeholder="留空则自动获取">
              <button type="button" class="btn-toggle-secret" data-target="qqbotToken" title="显示/隐藏">
                <svg class="eye-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                  <circle cx="12" cy="12" r="3"/>
                </svg>
                <svg class="eye-off-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display: none;">
                  <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"/>
                  <line x1="1" y1="1" x2="23" y2="23"/>
                </svg>
              </button>
            </div>
          </div>
        </section>

        <!-- Storage Paths -->
        <section class="config-section">
          <div class="section-header">
            <h2>
              <svg class="section-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/>
              </svg>
              存储路径
            </h2>
          </div>
          <div class="form-group">
            <label for="downloadPath">工作目录 (Claude 执行目录)</label>
            <div class="path-input-group">
              <input type="text" id="downloadPath" class="form-input" placeholder="./workspace">
              <button type="button" class="btn-verify-path" data-path="downloadPath" title="验证路径">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <polyline points="20 6 9 17 4 12"/>
                </svg>
              </button>
            </div>
            <div class="path-status" id="downloadPath-status"></div>
          </div>
          <div class="form-group">
            <label for="uploadPath">上传目录 (用户文件存储)</label>
            <div class="path-input-group">
              <input type="text" id="uploadPath" class="form-input" placeholder="./uploads">
              <button type="button" class="btn-verify-path" data-path="uploadPath" title="验证路径">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <polyline points="20 6 9 17 4 12"/>
                </svg>
              </button>
            </div>
            <div class="path-status" id="uploadPath-status"></div>
          </div>
          <div class="form-group">
            <label for="schedulerResultDir">任务结果目录</label>
            <div class="path-input-group">
              <input type="text" id="schedulerResultDir" class="form-input" placeholder="./data/task-results">
              <button type="button" class="btn-verify-path" data-path="schedulerResultDir" title="验证路径">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <polyline points="20 6 9 17 4 12"/>
                </svg>
              </button>
            </div>
            <div class="path-status" id="schedulerResultDir-status"></div>
          </div>
        </section>

        <!-- Security Settings -->
        <section class="config-section">
          <div class="section-header">
            <h2>
              <svg class="section-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
                <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
              </svg>
              安全设置
            </h2>
          </div>
          <div class="form-group">
            <label for="allowedUsers">允许的用户 (OpenID 列表，逗号分隔)</label>
            <textarea id="allowedUsers" class="form-input" rows="3" placeholder="留空则允许所有用户访问"></textarea>
            <small class="form-hint">从 QQ 开放平台获取用户的 OpenID</small>
          </div>
        </section>

        <!-- Scheduler Settings -->
        <section class="config-section">
          <div class="section-header">
            <h2>
              <svg class="section-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"/>
                <polyline points="12 6 12 12 16 14"/>
              </svg>
              调度器设置
            </h2>
          </div>
          <div class="form-group checkbox-block">
            <input type="checkbox" id="schedulerEnabled" class="form-checkbox">
            <span>启用定时任务调度器</span>
          </div>
          <div class="form-group">
            <label for="schedulerMaxConcurrent">最大并发任务数</label>
            <input type="number" id="schedulerMaxConcurrent" class="form-input" min="1" max="10">
          </div>
          <div class="form-group">
            <label for="schedulerTaskTimeout">任务超时时间 (分钟)</label>
            <input type="number" id="schedulerTaskTimeout" class="form-input" min="1" max="120">
          </div>
        </section>

        <!-- Agent Settings -->
        <section class="config-section">
          <div class="section-header">
            <h2>
              <svg class="section-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/>
              </svg>
              Agent 设置
            </h2>
          </div>
          <div class="form-group">
            <label for="defaultAgent">默认 Agent</label>
            <select id="defaultAgent" class="form-input">
              <option value="coordinator">coordinator (智能协调)</option>
              <option value="claude">claude (Claude Code)</option>
              <option value="code">code (代码生成)</option>
              <option value="browser">browser (浏览器操作)</option>
            </select>
          </div>
          <div class="form-group checkbox-block">
            <input type="checkbox" id="smartRouting" class="form-checkbox">
            <span>启用智能路由</span>
          </div>
          <div class="form-group checkbox-block">
            <input type="checkbox" id="useCoordinator" class="form-checkbox">
            <span>启用 Coordinator Agent (协作模式)</span>
          </div>
        </section>

        <!-- LLM Provider Settings -->
        <section class="config-section">
          <div class="section-header">
            <h2>
              <svg class="section-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/>
                <polyline points="3.27 6.96 12 12.01 20.73 6.96"/>
                <line x1="12" y1="22.08" x2="12" y2="12"/>
              </svg>
              LLM 提供商设置
            </h2>
          </div>
          <div class="form-group">
            <label for="llmProvider">默认提供商</label>
            <select id="llmProvider" class="form-input">
              <option value="glm">GLM (智谱 AI)</option>
              <option value="anthropic">Anthropic (Claude)</option>
              <option value="openai">OpenAI (GPT)</option>
            </select>
            <small class="form-hint">选择默认使用的 LLM 提供商</small>
          </div>
          <div class="form-group">
            <label for="llmModel">默认模型</label>
            <input type="text" id="llmModel" class="form-input" placeholder="glm-4.7">
            <small class="form-hint">模型名称，如: glm-4.7, claude-3-5-sonnet-20241022, gpt-4</small>
          </div>
          <div class="form-group">
            <label for="llmMaxTokens">最大 Tokens</label>
            <input type="number" id="llmMaxTokens" class="form-input" min="128" max="128000" step="128">
            <small class="form-hint">单次请求的最大 token 数量</small>
          </div>
          <div class="form-group">
            <label for="llmBaseUrl">API Base URL (可选)</label>
            <input type="text" id="llmBaseUrl" class="form-input" placeholder="留空使用默认端点">
            <small class="form-hint">自定义 API 端点，用于兼容或代理服务</small>
          </div>

          <!-- GLM 特定配置 -->
          <div class="provider-config" id="glmConfig">
            <h3 class="provider-config-title">GLM 特定配置</h3>
            <div class="form-group">
              <label for="glmApiKey">GLM API Key</label>
              <div class="secret-input-group">
                <input type="password" id="glmApiKey" class="form-input" placeholder="从智谱 AI 开放平台获取">
                <button type="button" class="btn-toggle-secret" data-target="glmApiKey" title="显示/隐藏">
                  <svg class="eye-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                    <circle cx="12" cy="12" r="3"/>
                  </svg>
                  <svg class="eye-off-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display: none;">
                    <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"/>
                    <line x1="1" y1="1" x2="23" y2="23"/>
                  </svg>
                </button>
              </div>
            </div>
            <div class="form-group checkbox-block">
              <input type="checkbox" id="glmUseJwt" class="form-checkbox">
              <span>使用 JWT 认证 (API Key 包含 "." 时自动启用)</span>
            </div>
            <div class="form-group checkbox-block">
              <input type="checkbox" id="glmIsCodingPlan" class="form-checkbox">
              <span>使用 Coding Plan 端点 (增强代码生成能力)</span>
            </div>
          </div>

          <!-- Anthropic 特定配置 -->
          <div class="provider-config" id="anthropicConfig" style="display: none;">
            <h3 class="provider-config-title">Anthropic 特定配置</h3>
            <div class="form-group">
              <label for="anthropicApiKey">Anthropic API Key</label>
              <div class="secret-input-group">
                <input type="password" id="anthropicApiKey" class="form-input" placeholder="从 Anthropic Console 获取">
                <button type="button" class="btn-toggle-secret" data-target="anthropicApiKey" title="显示/隐藏">
                  <svg class="eye-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                    <circle cx="12" cy="12" r="3"/>
                  </svg>
                  <svg class="eye-off-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display: none;">
                    <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"/>
                    <line x1="1" y1="1" x2="23" y2="23"/>
                  </svg>
                </button>
              </div>
            </div>
            <div class="form-group">
              <label for="anthropicModel">Anthropic 模型</label>
              <select id="anthropicModel" class="form-input">
                <option value="claude-3-5-sonnet-20241022">Claude 3.5 Sonnet (推荐)</option>
                <option value="claude-3-5-haiku-20241022">Claude 3.5 Haiku</option>
                <option value="claude-3-opus-20240229">Claude 3 Opus</option>
              </select>
            </div>
          </div>

          <!-- OpenAI 特定配置 -->
          <div class="provider-config" id="openaiConfig" style="display: none;">
            <h3 class="provider-config-title">OpenAI 特定配置</h3>
            <div class="form-group">
              <label for="openaiApiKey">OpenAI API Key</label>
              <div class="secret-input-group">
                <input type="password" id="openaiApiKey" class="form-input" placeholder="从 OpenAI Platform 获取">
                <button type="button" class="btn-toggle-secret" data-target="openaiApiKey" title="显示/隐藏">
                  <svg class="eye-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                    <circle cx="12" cy="12" r="3"/>
                  </svg>
                  <svg class="eye-off-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display: none;">
                    <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"/>
                    <line x1="1" y1="1" x2="23" y2="23"/>
                  </svg>
                </button>
              </div>
            </div>
            <div class="form-group">
              <label for="openaiBaseUrl">OpenAI Base URL</label>
              <input type="text" id="openaiBaseUrl" class="form-input" placeholder="https://api.openai.com/v1">
              <small class="form-hint">支持自定义端点，如 Azure OpenAI 或代理服务</small>
            </div>
            <div class="form-group">
              <label for="openaiModel">OpenAI 模型</label>
              <select id="openaiModel" class="form-input">
                <option value="gpt-4">GPT-4</option>
                <option value="gpt-4-turbo">GPT-4 Turbo</option>
                <option value="gpt-3.5-turbo">GPT-3.5 Turbo</option>
              </select>
            </div>
          </div>

          <!-- 测试连接按钮 -->
          <div class="form-group">
            <button type="button" class="btn-secondary" id="testConnectionBtn">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                <polyline points="22 4 12 14.01 9 11.01"/>
              </svg>
              测试连接
            </button>
            <div id="connectionTestResult" class="connection-test-result"></div>
          </div>
        </section>
      </div>
    </main>
  </div>

  <!-- Toast Notifications -->
  <div class="toast-container" id="toastContainer"></div>

  <script src="config.js?v=1.0"></script>
</body>
</html>
